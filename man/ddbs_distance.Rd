% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/ddbs_measure.R
\name{ddbs_distance}
\alias{ddbs_distance}
\title{Calculate the distance between geometries}
\usage{
ddbs_distance(
  x,
  y,
  dist_type = NULL,
  conn = NULL,
  conn_x = NULL,
  conn_y = NULL,
  quiet = FALSE
)
}
\arguments{
\item{x}{Input spatial data. Can be:
\itemize{
\item A \code{duckspatial_df} object (lazy spatial data frame via dbplyr)
\item An \code{sf} object
\item A \code{tbl_lazy} from dbplyr
\item A character string naming a table/view in \code{conn}
}
Data is returned from this object.}

\item{y}{Input spatial data. Can be:
\itemize{
\item A \code{duckspatial_df} object (lazy spatial data frame via dbplyr)
\item An \code{sf} object
\item A \code{tbl_lazy} from dbplyr
\item A character string naming a table/view in \code{conn}
}}

\item{dist_type}{Character. Distance type to be calculated. By the default it uses
the best option for the input CRS (see details).}

\item{conn}{A connection object to a DuckDB database. If \code{NULL}, the function
runs on a temporary DuckDB database.}

\item{conn_x}{A \code{DBIConnection} object to a DuckDB database for the input \code{x}.
If \code{NULL} (default), it is resolved from \code{conn} or extracted from \code{x}.}

\item{conn_y}{A \code{DBIConnection} object to a DuckDB database for the input \code{y}.
If \code{NULL} (default), it is resolved from \code{conn} or extracted from \code{y}.}

\item{quiet}{A logical value. If \code{TRUE}, suppresses any informational messages.
Defaults to \code{FALSE}.}
}
\value{
A \code{units} matrix in meters
}
\description{
Computes the distance between two geometries, automatically using an appropriate
measurement based on their coordinate reference system and geometry type.
}
\details{
The \code{dist_type} argument can take any of the following values:
\itemize{
\item \code{NULL} (default): it will use the best option for the inputs CRS
\item \code{"planar"}: planar distance between two geometries (default for projected CRS)
\item \code{"geos"}: planar distance between two geometries using GEOS library
\item \code{"haversine"}: returns the great circle distance. Requires the input to be
in WGS84 (EPSG:4326) and POINT geometry (default for EPSG:4326).
\item \code{"spheroid"}: returns the distance using an ellipsoidal model of the earth's
surface using the GeographicLib library. It's highly accurate but the slowest
}

Note that geometries different than POINT are not supported by "haversine" nor "spheroid".
}
\examples{
\dontrun{
# load packages
library(duckspatial)

# create points data
n <- 10
points_sf <- data.frame(
    id = 1:n,
    x = runif(n, min = -180, max = 180),
    y = runif(n, min = -90, max = 90)
) |>
    ddbs_as_spatial(coords = c("x", "y"), crs = "EPSG:4326")

# option 1: passing sf objects
output1 <- duckspatial::ddbs_distance(
    x = points_sf,
    y = points_sf,
    dist_type = "haversine"
)

head(output1)


## option 2: passing the names of tables in a duckdb db and output as sf

# creates a duckdb
conn <- duckspatial::ddbs_create_conn()

# write sf to duckdb
ddbs_write_vector(conn, points_sf, "points", overwrite = TRUE)

output2 <- ddbs_distance(
    conn = conn,
    x = "points",
    y = "points",
    dist_type = "haversine"
)
head(output2)

}
}
